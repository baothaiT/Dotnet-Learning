version: "3.8"

networks:
  jaegear_network:
    external: true
services:
  c001_jaegear:
    container_name: c001_jaegear
    networks:
     - jaegear_network

    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_HTTP_PORTS: 8080
      JAEGER_AGENT_ENDPOINT: http://jaeger:14268/api/traces
      JAEGER_AGENT_HOST: jaeger
      JAEGER_AGENT_PORT: 6831
    ports:
      - "5000:8080"
    depends_on:
      - jaeger

  jaeger:
    image: jaegertracing/all-in-one:latest
    container_name: jaeger
    ports:
      - "6831:6831/udp"  # Enable UDP for Jaeger Tracing
      - "6832:6832/udp"  # Enable UDP for Jaeger Tracing (optional)
      - "16686:16686"    # Jaeger UI
      - "14250:14250"    # gRPC collector
      - "14268:14268"    # HTTP collector
    environment:
      - COLLECTOR_ZIPKIN_HTTP_PORT=9411
      - COLLECTOR_OTLP_ENABLED=true
      - SPAN_STORAGE_TYPE=memory
      - JAEGER_COLLECTOR_PORT=14250
      - JAEGER_AGENT_UDP_PORT=6831  # Ensure Jaeger Agent uses port 6831
    # command: [
    #   "--collector.grpc-server.host-port=14250",
    #   "--collector.http-server.host-port=14268",
    #   "--query.base-path=/",
    #   "--agent.udp-server.host-port=6831"
    # ]
    networks:
      - jaegear_network